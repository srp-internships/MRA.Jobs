@using Blazored.LocalStorage;
@using MRA.Jobs.Application.Contracts.TrainingVacancies.Responses;
@using MRA.Jobs.Application.Contracts.VacancyClient;
@using MRA.Jobs.Client.Identity;
@using Microsoft.AspNetCore.Components.Authorization;
@inject AuthenticationStateProvider provider
@inject IApplicationService ApplicationService


<div class="container">
    <div class="row align-items-center">
        <div class="col-md-8 col-sm-12">
            <MudPaper Class="pa-16 ma-2 details">
                <MudText Typo="Typo.h2" Style="color: #129fd7; font-weight: 900;">@vacancyDetails.Title</MudText>
                <MudText Typo="Typo.h6">Duration: @vacancyDetails.Duration month(s)</MudText>
                <MudText Typo="Typo.h6">Published at: @vacancyDetails.PublishDate.Day/@vacancyDetails.PublishDate.Month/@vacancyDetails.PublishDate.Year</MudText>
                <MudText Typo="Typo.h6">Deadline: @vacancyDetails.EndDate.Date.Day/@vacancyDetails.EndDate.Date.Month/@vacancyDetails.EndDate.Date.Year</MudText>
                <MudDivider />
                <MudText Typo="Typo.h5">Description</MudText>
                <MudText Typo="Typo.body1">@((MarkupString)@vacancyDetails.Description)</MudText>
                </MudPaper>
            </div>
            <div class="col-md-4 col-sm-12">
                <MudCard>
                    <MudCardContent>
                        <MudText Typo="Typo.h5" Color="Color.Info">Do You want to work at Silk Road Professionals?</MudText>
                        <MudText Typo="Typo.body2">Write a cover letter, answer few questions and send yout application!</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <CascadingAuthenticationState>
                            <AuthorizeView>
                                <Authorized>
                                    @if (applied)
                                {
                                    <span class="text-success"> <i class="fa fa-check" aria-hidden="true"></i>Applied</span>
                                }
                                else
                                {
                                    <a href="/trainings/ApplytoTrainings/@Slug" class="btn btn-primary w-100">Apply</a>
                                }
                            </Authorized>
                            <NotAuthorized>
                                <a href="/sign-in" class="btn btn-primary w-100">Apply</a>
                            </NotAuthorized>
                        </AuthorizeView>
                    </CascadingAuthenticationState>
                </MudCardActions>
            </MudCard>
        </div>
    </div>
</div>



@code {
    [Parameter]
    public string Slug { get; set; }

    [Parameter]
    public VacancyDetailsResponse vacancyDetails { get; set; }
    private bool applied = false;

    private async Task<bool> ApplicationExits()
    {
        return await ApplicationService.ApplicationExist(Slug);
    }
}

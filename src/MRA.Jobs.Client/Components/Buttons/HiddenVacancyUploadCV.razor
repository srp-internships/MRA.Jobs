@using MRA.Jobs.Application.Contracts.HiddenVacancies.Responses
@using MRA.Jobs.Client.Services.HiddenVacancies
@inject NavigationManager NavigationManager
@inject IHiddenVacancyService HiddenVacancyService



  <CascadingAuthenticationState>
            <AuthorizeView>
                <Authorized>
                    @if (_applicationWithHiddenVacancyStatus == null || !_applicationWithHiddenVacancyStatus.Applied)
                    {
                        <MudCardContent>
                            <MudText>
                                If you would like to nominate yourself, send us your СV.
                            </MudText>
                        </MudCardContent>
                        <MudCardActions>
                            <MudButton Variant="Variant.Filled" Color="Color.Primary"
                                       OnClick="ApplyHiddenVacancy" FullWidth="true">
                                <MudText>Upload CV</MudText>
                            </MudButton>
                        </MudCardActions>
                    }
                    else
                    {
                        <MudCardContent>
                            <MudText>
                                The status of your CV for your candidacy is <b>@_applicationWithHiddenVacancyStatus.Status.ToString()</b>
                            </MudText>
                        </MudCardContent>
                        @if (_applicationWithHiddenVacancyStatus.Status == ApplicationStatusDto.ApplicationStatus.Expired
                             || _applicationWithHiddenVacancyStatus.Status == ApplicationStatusDto.ApplicationStatus.Rejected
                             || _applicationWithHiddenVacancyStatus.Status == ApplicationStatusDto.ApplicationStatus.Refused)
                        {
                            <MudCardActions>
                                <MudButton Variant="Variant.Filled" Color="Color.Primary"
                                           OnClick="ApplyHiddenVacancy" FullWidth="true">
                                    <MudText>Upload New CV</MudText>
                                </MudButton>
                            </MudCardActions>
                        }
                    }
                </Authorized>
                <NotAuthorized>

                    <MudCardContent>
                        <MudText >
                            If you would like to nominate yourself, sign in and send us your СV.
                        </MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" OnClick="SignIn" Color="Color.Primary" FullWidth="true">
                            <MudText>Sign In</MudText>
                        </MudButton>
                    </MudCardActions>


                </NotAuthorized>
            </AuthorizeView>
        </CascadingAuthenticationState>

@code {
    private ApplicationWithHiddenVacancyStatus _applicationWithHiddenVacancyStatus;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        _applicationWithHiddenVacancyStatus = await HiddenVacancyService.GetApplicationStatus();
    }

    private void ApplyHiddenVacancy()
    {
        NavigationManager.NavigateTo("/upload-cv");
    }

    private void SignIn()
    {
        NavigationManager.NavigateTo("/sign-in");
    }

}
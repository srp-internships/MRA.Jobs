@page "/dashboard/applications"
@attribute [Authorize(ApplicationPolicies.Administrator)]
@using System.Net.Http.Json
@using MRA.Jobs.Client.Identity;
@inject HttpClient httpClient
@inject IApplicationService applicationService

<MudText Typo="Typo.h3" Style="margin:50px; color: #129fd7; text-align: center; font-weight: 900">Applications</MudText>

<MudContainer Class="text-center">
    <MudTable Items="@applications.Items" Class="text-center">
        <ColGroup>
            <col style="width: 25%;" />
            <col style="width: 25%;" />
            <col style="width: 25%;" />
            <col style="width: 25%" />
            <col />
        </ColGroup>
        <HeaderContent>
            <MudTh>Appliant username</MudTh>
            <MudTh>Vacancy title</MudTh>
            <MudTh>Applied at</MudTh>
            <MudTh>Status name</MudTh>
            <MudTh>Action</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Username">@context.Username</MudTd>
            <MudTd DataLabel="Title">@context.VacancyTitle</MudTd>
            <MudTd DataLabel="Applied at">@context.CreatedAt.ToString("D")</MudTd>
            <MudTd DataLabel="StatusName">@context.StatusName</MudTd>
            <MudTd DataLabel="Name"><MudButton Variant="Variant.Filled" OnClick="@((e) => OpenDialog(maxWidth, context.CoverLetter, context.VacancyResponses, context.Slug, context.StatusName))">More</MudButton></MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager />
        </PagerContent>
    </MudTable>

</MudContainer>

@code {

    private PagedList<ApplicationListDto> applications;
    protected override async Task OnInitializedAsync()
    {
        var response = await applicationService.GetAllApplications();
        if (response is not null)
        {
            applications = response;
        }
    }
    DialogOptions maxWidth = new DialogOptions() { MaxWidth = MaxWidth.Medium, FullWidth = true };

    private void OpenDialog(DialogOptions options, string coverLetter, IEnumerable<VacancyResponseDto> vacancyResponses, string slug, string statusName)
    {
        Dialog.Show<MyDialog>("Applicant response", new DialogParameters { { "CoverLetter", coverLetter }, { "VacancyResponses", vacancyResponses }, { "Slug", slug }, { "StatusName", statusName }, { "isApplicant", false } }, options);
    }
}